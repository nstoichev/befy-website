<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>Kosher</title>

  <link rel="shortcut icon" type="image/x-icon" href="css/images/favicon.ico" />
  <link href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" rel="stylesheet">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./new-styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <script type="text/javascript">
    var staticJsonData = {
      "2023-08-01": {
        "temp": 18.44,
        "mas": 46.2,
        "hum": 100
      },
      "2023-08-02": {
        "temp": 18.42,
        "mas": 45.2,
        "hum": 100
      },
      "2023-08-03": {
        "temp": 18.40,
        "mas": 44.2,
        "hum": 97
      },
      "2023-08-04": {
        "temp": 18.35,
        "mas": 43.2,
        "hum": 97
      },
      "2023-08-05": {
        "temp": 18.30,
        "mas": 42.2,
        "hum": 96
      },
      "2023-08-06": {
        "temp": 18.20,
        "mas": 41.2,
        "hum": 95
      },
      "2023-08-07": {
        "temp": 18.02,
        "mas": 42.2,
        "hum": 95
      },
      "2023-08-08": {
        "temp": 17.58,
        "mas": 43.2,
        "hum": 95
      },
      "2023-08-09": {
        "temp": 17.55,
        "mas": 44.2,
        "hum": 100
      },
      "2023-08-10": {
        "temp": 17.50,
        "mas": 45.2,
        "hum": 95
      },
      "2023-08-11": {
        "temp": 18.00,
        "mas": 46.2,
        "hum": 95
      },
      "2023-08-12": {
        "temp": 18.10,
        "mas": 47.2,
        "hum": 97
      },
      "2023-08-13": {
        "temp": 18.24,
        "mas": 48.2,
        "hum": 98
      },
      "2023-08-14": {
        "temp": 18.35,
        "mas": 49.2,
        "hum": 100
      },
      "2023-08-15": {
        "temp": 18.44,
        "mas": 46.2,
        "hum": 100
      },
      "2023-08-16": {
        "temp": 18.42,
        "mas": 45.2,
        "hum": 100
      },
      "2023-08-17": {
        "temp": 18.40,
        "mas": 44.2,
        "hum": 97
      },
      "2023-08-18": {
        "temp": 18.35,
        "mas": 43.2,
        "hum": 97
      },
      "2023-08-19": {
        "temp": 18.30,
        "mas": 42.2,
        "hum": 96
      },
      "2023-08-20": {
        "temp": 18.20,
        "mas": 41.2,
        "hum": 95
      },
      "2023-08-21": {
        "temp": 18.02,
        "mas": 42.2,
        "hum": 95
      },
      "2023-08-22": {
        "temp": 17.58,
        "mas": 43.2,
        "hum": 95
      },
      "2023-08-23": {
        "temp": 17.55,
        "mas": 44.2,
        "hum": 100
      },
      "2023-08-24": {
        "temp": 17.50,
        "mas": 45.2,
        "hum": 95
      },
      "2023-08-25": {
        "temp": 18.00,
        "mas": 46.2,
        "hum": 95
      },
      "2023-08-26": {
        "temp": 18.10,
        "mas": 47.2,
        "hum": 97
      },
      "2023-08-27": {
        "temp": 18.24,
        "mas": 48.2,
        "hum": 98
      },
      "2023-08-28": {
        "temp": 18.35,
        "mas": 49.2,
        "hum": 100
      }
    }
  </script>

  <div class="wrapper">
    <header class="header">
      <div class="header__inner">
        <div class="header__logo">
          <a href="#" class="logo">
            <span class="logo__image">
              <img src="./logo-small.png" alt="" />
            </span>

            <span class="logo__text">BeFy</span>
          </a>
        </div><!-- /.header__logo -->

        <nav-menu>
          <nav class="nav">
            <ul>
              <li>
                <a href="#" class="active" data-tab=".tab-dashboard">
                  <span class="icon">
                    <i class="fas fa-home fa-fw"></i>
                  </span>

                  <spn class="text">Dashboard</spn><!-- /.text -->
                </a>
              </li>

              <li>
                <details>
                  <summary data-tab>
                    <span class="icon">
                      <i class="fab fa-forumbee"></i>
                    </span>
                    Пчелини
                  </summary>

                  <ul>
                    <li>
                      <a href="#" data-tab=".tab-hive-1">
                        <span class="icon">
                          <i class="fas fa-arrow-right"></i>
                        </span>
                        Пчелин 1</a>
                    </li>

                    <li>
                      <a href="#" data-tab=".tab-hive-2">
                        <span class="icon">
                          <i class="fas fa-arrow-right"></i>
                        </span>
                        Пчелин 2</a>
                    </li>

                    <li>
                      <a href="#" data-tab=".tab-hive-3">
                        <span class="icon">
                          <i class="fas fa-arrow-right"></i>
                        </span>
                        Пчелин 3</a>
                    </li>
                  </ul>
                </details>
              </li>

              <li>
                <a href="#" data-tab=".tab-settings">
                  <span class="icon">
                    <i class="fas fa-cog fa-fw"></i>
                  </span>

                  <span class="text">Settings</span>
                </a>
              </li>
            </ul>
          </nav><!-- /.nav -->
        </nav-menu>
      </div><!-- /.header__inner -->
    </header><!-- /.header -->

    <div class="main">
      <div class="tollbar">
        <menu-toggle class="btn-menu" data-target=".header">
          <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 283.426 283.426" xml:space="preserve">
            <g>
              <rect x="0" y="40.84" style="fill: currentColor;" width="283.426" height="47.735"/>
              <rect x="0" y="117.282" style="fill: currentColor;" width="283.426" height="47.735"/>
              <rect x="0" y="194.851" style="fill: currentColor;" width="283.426" height="47.735"/>
            </g>
          </svg>
        </menu-toggle>

        <nav class="nav-access">
          <ul>
            <li>
              <span>Logged in as: Borko</span>
            </li>

            <li>
              <a href="#">
                <span class="icon">
                  <i class="fas fa-arrow-circle-right"></i>
                </span>
                Logout
              </a>
            </li>
          </ul>
        </nav><!-- / .nav-access -->
      </div><!-- / .tollbar -->

      <div class="content">
        <div class="tabs">
          <div class="tab tab-dashboard active">
            Dashboard
          </div><!-- /.tab -->

          <div class="tab tab-hive-1">
            <div class="hive">
              <div class="hive__head">
                <h4 class="hive__name">
                  Везна 1
                </h4><!-- /.hive__name -->
              </div><!-- /.hive__head -->

              <div class="hive__inner">
                <details class="hive__details">
                  <summary class="hive__cta">
                    <span class="text">Детайли</span>

                    <span class="icon">
                      <i class="fas fa-th-list"></i>
                    </span>
                  </summary>

                  <div class="hive__form">
                    <hive-data>
                      <form action="/action_page.php" id="date-form">
                        <label for="birthday">Period:</label>
                        <input type="date" name="start" required>
                        <input type="date" name="end" required>
                        <input type="submit" value="Submit">
                      </form>

                      <hive-chart class="hive__chart"
                        data-stat="temp"
                        data-title="Temperature (°C)"
                        data-color="rgba(56,205,77, 0.7)"
                      >
                        <canvas></canvas>
                      </hive-chart><!-- /.hive__chart -->

                      <hive-chart class="hive__chart"
                        data-stat="hum"
                        data-title="Humidity (%)"
                        data-color="rgba(91,219,224, 0.7)"
                      >
                        <canvas></canvas>
                      </hive-chart><!-- /.hive__chart -->

                      <hive-chart class="hive__chart"
                        data-stat="mas"
                        data-title="Mass (kg)"
                        data-color="rgba(252,98,105, 0.7)"
                      >
                        <canvas></canvas>
                      </hive-chart><!-- /.hive__chart -->
                    </hive-data>
                  </div><!-- /.hive__form -->
                </details>

                <div class="hive__body">
                  <div class="hive__preview">
                    <div class="hive__image">
                      <img src="befi-logo.png" alt="" />
                    </div><!-- /.hive__image -->

                    <a href="#" class="hive__action">
                      <span class="icon">
                        <i class="fas fa-chart-line"></i>
                      </span>

                      <span class="text">Прираст на нектар</span>
                    </a>
                  </div><!-- /.hive__preview -->

                  <div class="hive__content">
                    <h5 class="hive__subtitle">
                      Последни данни:
                    </h5><!-- /.hive__subtitle -->

                    <ul class="hive__list">
                      <li>
                        <div class="hive__list-head">
                          <span class="icon">
                            <i class="fas fa-weight-hanging"></i>
                          </span>

                          <span class="text">
                            Маса
                          </span>

                          <span class="value">
                            <strong>46.2</strong> kg
                          </span>
                        </div><!-- /.hive__list-head -->
                      </li>

                      <li>
                        <details class="temp">
                          <summary class="hive__list-head">
                            <span class="icon">
                              <i class="fas fa-thermometer-full"></i>
                            </span>

                            <span class="text">
                              Температура
                            </span>

                            <span class="value">
                              <strong>19.3</strong> &deg;C
                            </span>
                          </summary><!-- /.hive__list-head -->

                          <hive-chart class="hive__list-chart" data-stat="temp" data-title="Temperature (°C)">
                            <canvas></canvas>
                          </hive-chart><!-- /.hive__list-chart -->
                        </details>
                      </li>

                      <li>
                        <details class="hum">
                          <summary class="hive__list-head">
                            <span class="icon">
                              <i class="fas fa-tint"></i>
                            </span>

                            <span class="text">
                              Влажност
                            </span>

                            <span class="value">
                              <strong>100</strong> %
                            </span>
                          </summary><!-- /.hive__list-head -->

                          <hive-chart class="hive__list-chart" data-stat="hum" data-title="Humidity (%)">
                            <canvas></canvas>
                          </hive-chart><!-- /.hive__list-chart -->
                        </details>
                      </li>

                      <li>
                        <div class="hive__list-head">
                          <span class="icon">
                            <i class="fas fa-cloud"></i>
                          </span>

                          <span class="text">
                            Атмосферно налягане
                          </span>

                          <span class="value">
                            <strong>976.26</strong> hPa
                          </span>
                        </div><!-- /.hive__list-head -->
                      </li>

                      <li>
                        <div class="hive__list-head">
                          <span class="icon">
                            <i class="fas fa-battery-full"></i>
                          </span>

                          <span class="text">
                            Батерия
                          </span>

                          <span class="value">
                            <strong>4.21</strong> V
                          </span>
                        </div><!-- /.hive__list-head -->
                      </li>

                      <li>
                        <div class="hive__list-head">
                          <span class="icon">
                            <i class="fas fa-thermometer-full"></i>
                          </span>

                          <span class="text">
                            Температура на сензор
                          </span>

                          <span class="value">
                            <strong>18.44</strong> &deg;C
                          </span>
                        </div><!-- /.hive__list-head -->
                      </li>
                    </ul><!-- /.hive__list -->
                  </div><!-- /.hive__content -->
                </div><!-- /.hive__body -->
              </div><!-- /.hive__inner -->


              <div class="hive__foot">
                <div class="date">
                  <span class="day">02.09</span> <span class="time">05:08</span>
                </div><!-- /.date -->
              </div><!-- /.hive__foot -->
            </div><!-- /.hive -->
          </div><!-- /.tab -->

          <div class="tab tab-settings">
            <h1>Settings</h1>
          </div><!-- /.tab -->
        </div><!-- /.tabs -->
      </div><!-- /.content -->
    </div><!-- / .main -->
  </div><!-- /.wrapper -->
</body>
</html>

<script type="text/javascript">
  (() => {
    if (customElements.get('menu-toggle')) {
      return;
    }

    class MenuToggle extends HTMLElement {
      constructor() {
        super();
        this.menu = document.querySelector(this.dataset.target);
      }

      connectedCallback() {
        this.addEventListener('click', () => {
          this.toggleMenu()
        })
      }

      toggleMenu() {
        if (this.menu != null) {
          this.menu.classList.toggle('open');
        };
      }
    }

    customElements.define('menu-toggle', MenuToggle);
  })();
</script>

<script type="text/javascript">
  (() => {
    if (customElements.get('nav-menu')) {
      return;
    }

    class NavMenu extends HTMLElement {
      constructor() {
        super();
        this.triggers = this.querySelectorAll('[data-tab]');
        this.activeClas = 'active'
        this.header = this.closest('.header');
      }

      connectedCallback() {
        this.triggers.forEach(trigger => {
          trigger.addEventListener('click', (event) => {
            if (!trigger.closest('details')) {
              event.preventDefault();
            };

            this.toggleTabs(trigger);
          });
        });
      }

      toggleTabs(tabTrigger) {
        const datTarget = tabTrigger.dataset.tab;

        // Close the header menu only if the trigger is not SUMMARY tag.
        if (tabTrigger.tagName != 'SUMMARY') {
          setTimeout(() => {
            this.header.classList.remove('open');
          }, 300);
        };

        this.triggers.forEach(itemTrigger => {
          itemTrigger.classList.remove(this.activeClas);
          const siblingDatTarget = itemTrigger.dataset.tab;

          if (siblingDatTarget.length) {
            const siblingTargetTab = document.querySelector(siblingDatTarget);

            if (siblingTargetTab != null) {
              siblingTargetTab.classList.remove(this.activeClas);
            };
          };
        });

        tabTrigger.classList.add(this.activeClas);

        if (datTarget.length) {
          const targetTab = document.querySelector(datTarget);

          if (targetTab != null) {
            targetTab.classList.add(this.activeClas);
          };
        };
      }
    }

    customElements.define('nav-menu', NavMenu);
  })();
</script>

<script type="text/javascript">
  (() => {
    if (customElements.get('hive-data')) {
      return;
    }

    class HiveData extends HTMLElement {
      constructor() {
        super();
        this.form = this.querySelector('form');
        this.charts = this.querySelectorAll('hive-chart');
        this.staticData = staticJsonData;
        this.chartInstances = []; // Store chart instances
      }

      connectedCallback() {
        this.form.addEventListener('submit', (event) => {
          event.preventDefault(); // Prevent form submission for this example

          // Destroy previously generated charts
          this.chartInstances.forEach(chartInstance => {
            chartInstance.destroy();
          });

          this.chartInstances = []; // Clear chart instances

          const period = this.renderData();

          this.initChart(period);

          window.addEventListener("resize", (event) => {
            this.chartInstances.forEach(chartInstance => {
              chartInstance.destroy();
            });

            this.initChart(period);
          });
        });
      }

      renderData() {
        var startDate = new Date(this.form.querySelector('input[name="start"]').value);
        var endDate = new Date(this.form.querySelector('input[name="end"]').value);
        var datesArray = [];

        // Loop through all dates between start and end dates
        while (startDate <= endDate) {
          const dayFormat = new Date(startDate)
          datesArray.push(startDate.toISOString().slice(0, 10)); // Format as YYYY-MM-DD
          startDate.setDate(startDate.getDate() + 1); // Move to the next day
        }

        return datesArray;
      }

      initChart(dataPeriod) {
				console.log('this.charts');
				console.log(this.charts);
				
        this.charts.forEach(chart => {
          const dynamicData = this.filterDataByPeriod(this.staticData, dataPeriod)
          const ctx = chart.querySelector('canvas').getContext('2d');
          const dates = Object.keys(dynamicData);
          const dataValues = Object.values(dynamicData);
          const humValues = dataValues.map(item => item.hum);
          const tempValues = dataValues.map(item => item[chart.dataset.stat]);
          const chartLabel = chart.dataset.title
          const chartColor = chart.dataset.color

          // Chart
          let temperatureChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: dates,
              datasets: [
                {
                  label: chartLabel,
                  data: tempValues,
                  borderColor: chartColor,
                  borderWidth: 2,
                  pointRadius: 4,
                  pointBackgroundColor: '#000000',
                  fill: true,
                  backgroundColor: chartColor
                }
              ]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: false
                }
              }
            }
          });

          this.chartInstances.push(temperatureChart);
        });
      }

      filterDataByPeriod(data, selectedPeriod) {
        var newObject = {};

        for (var date in data) {
          if (selectedPeriod.includes(date)) {
            newObject[date] = data[date];
          }
        }

        return newObject;
      }
    }

    customElements.define('hive-data', HiveData);
  })();
</script>
